<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Hello React!</title>
     <script src="http://cdn.bootcss.com/react/0.14.1/react.js"></script>
    <script src="http://cdn.bootcss.com/react/0.14.1/react-dom.js"></script>
    <script src="http://cdn.bootcss.com/babel-core/5.8.32/browser.min.js"></script>
    <style type="text/css">
    	input {
    		outline: none;
    	}
    	.box {
    		width: 700px;
    		margin: 20px auto;
    		background-color: #f5f5f5;
    	}
		header {
			text-align: center;
			font-size: 50px;
			color: #e9d6d6;
		}	
		.input {
			text-align: center;
		}
		.input>input{
			width: 80%;
			height: 30px;
		}
		
		ul {
			list-style: none;
		}
		.select {
			width: 40px;
			height: 40px;
			border-radius: 50%;
			border: 1px solid #dbebe8;
		}

		.checkbox {
			width: 30px;
			height: 30px;
			vertical-align: top;
			-webkit-appearance: none;
			border-radius: 50%;
			outline: none;
			background-color: #fff;	
		}
	
		.completed label {
			text-decoration: line-through;
		}

		.checkbox:checked::after,
		.completed .checkbox::after {
			content: '\2714';
			margin-left: 5px;
		    color: #758794; 
		    width: 100%; 
		    text-align: center; 
		    font-size: 2em; 
		    padding: 1px 0 0 0; 
		    vertical-align: text-top;
		}
		.value {
			display: inline-block;
			width: 75%;
			height: 40px;
			line-height: 40px;
			border: 1px solid #fff;
		}

		.filters {
			display: inline-block;
			margin-left: 150px;
		}
		.footer button {
			float: right;
		}
    </style>
  </head>
  <body>
   <section id="AppRoot" class="todoapp"></section>
    <script type="text/babel">
    	var todolist = {
    		name: 'todos',
    		todos: [{
    			completed: true,
    			title: 'learn react'
    		},{
    			completed: false,
    			title: 'learn redux'
    		},{
    			completed: false,
    			title: 'learn webpack'
    		},{
    			completed: false,
    			title: 'learn less'
    		}]
    	}

    	var App = React.createClass({
    		getInitialState: function  () {
    			return {
    				addTaskTitle: '',
    				todolist: todolist,
    				type: 'all'
    			}
    		},

    		//表单输入域
    		changeHandel: function  (e) {
    			this.setState({value: e.target.value});
    		},

    		/**
    		 * 添加任务
    		 *
    		 * @param      {<type>}   e       { parameter_description }
    		 * @return     {boolean}  { description_of_the_return_value }
    		 */
   			addTaskHandel: function  (e) {
   				let task = this.refs.addTask;
   				if (task.value === '') {
   					console.error('不能添加空的task');
   					return false;
   				}
   				this.setState(function  () {
   					let todos = this.states.todolist.todos,
   					    todo = {
   					    	completed: false,
   					    	title: task.value
   					    };
   					todos.push(todo);
   					return todos;
   				})
   			},

   			/**
   			 * 删除任务
   			 *
   			 * @param      {<type>}  index   The index
   			 * @return     {<type>}  { description_of_the_return_value }
   			 */
   			deleteTaskHandel: function  (index) {
				return function  () {
					let todos = this.state.todolist.todos,
						todolist = {
							todolist: {
								name: 'todos',
								todos: []
							}
						};
					todos.splice(index, 1);
					todolist.todolist.todos = todos;

					this.setState(todolist);

				}.bind(this)				
   			},

   			/**
   			 * 切换任务状态
   			 */
   			switchTaskCompletedHandel: function  (index) {
				return function  () {
					let todolist = this.state.todolist;
					todolist['todos'][index]['completed'] = !todolist.['todos'][index]['completed'];

					this.setState(todolist);
				}.bind(this);
   			},

   			/**
   			 * 切换任务类型
   			 */
   			switchListTypeHandel: function  () {
   				
   			}




    		render: function  () {
    			var style = {
    			background: 'red',
    			height: 100,
    			width: 100	
    		};
			return <div className="box">
				<Header todolist={this.state.todolist}/>
				<TodoList todolist={this.state.todolist}/>
				<Footer />
			</div>
    		}
    	})

    	var Header = React.createClass({
    		onEnter: function  (e) {
    			var keyCode = e.keyCode ? e.keyCode : e.which;
    			var todolist = this.props.todolist;
    			if (keyCode === 13) {
    				var title = e.target.value;
    				if (title.length > 0) {
    					todolist.todos.push({completed: false, title: title});
    					console.log(todolist)
    				}		
    			}
    			
    		},

    		render: function  () {
    			return <div>
    				<header>todos</header>
    				<div className="input">
						<input placeholder="what need to be done?" onKeyUp={this.onEnter}/>
					</div>
    			</div>
    		}
    	})

    	var TodoList = React.createClass({
    		render: function  () {
    			var todolist = this.props.todolist;
    			return <ul>
    				{todolist.todos.map(function(value, i) {
    					var className = "";
			    		if (value.completed){
			    			className = "completed";
			    		}
			    		return <TodoItem className={className} key={i} value={value} />
    				})}
    			</ul>
    		}
    	})

    	var TodoItem = React.createClass({
    		render: function  () {
    			return <li className={this.props.className} >
							<input className="checkbox" type="checkbox" />
							<label  className="value">{this.props.value.title}</label>
						</li>
    		}
    	})

    	var Footer = React.createClass({
    		render: function  () {
    			
    			//计算还有多少个未完成的
    			var lefted = todolist.todos.reduce(function  (acc, todo) {
    				return todo.completed ? acc : acc + 1;
    			}, 0);

    			return <div className="footer">
						    <span>{lefted} items left</span>
						    <div className="filters">
								<a href="#">All</a>
								<a href="#">Active</a>
								<a href="#">Completed</a>
						    </div>
						    <button>Clear completed</button>
						</div>
    		}
    	})
		ReactDOM.render(<App />, document.getElementById('AppRoot'));



    </script>
  </body>
</html>