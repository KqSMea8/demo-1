<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Hello React!</title>
     <script src="http://cdn.bootcss.com/react/0.14.1/react.js"></script>
    <script src="http://cdn.bootcss.com/react/0.14.1/react-dom.js"></script>
    <script src="http://cdn.bootcss.com/babel-core/5.8.32/browser.min.js"></script>
    <style type="text/css">
    	input {
    		outline: none;
    	}
    	.box {
    		width: 700px;
    		margin: 20px auto;
    		background-color: #f5f5f5;
    	}
		header {
			text-align: center;
			font-size: 50px;
			color: #e9d6d6;
		}	
		.input {
			text-align: center;
		}
		.input>input{
			width: 80%;
			height: 30px;
		}
		
		ul {
			list-style: none;
		}
		.select {
			width: 40px;
			height: 40px;
			border-radius: 50%;
			border: 1px solid #dbebe8;
		}

		.checkbox {
			width: 30px;
			height: 30px;
			vertical-align: top;
			-webkit-appearance: none;
			border-radius: 50%;
			outline: none;
			background-color: #fff;	
		}
	
		.completed label {
			text-decoration: line-through;
		}

		.completed .checkbox::after {
			content: '\2714';
			margin-left: 5px;
		    color: #758794; 
		    width: 100%; 
		    text-align: center; 
		    font-size: 2em; 
		    padding: 1px 0 0 0; 
		    vertical-align: text-top;
		}
		.value {
			display: inline-block;
			width: 75%;
			height: 40px;
			line-height: 40px;
			border: 1px solid #fff;
		}

		.filters {
			display: inline-block;
			margin-left: 150px;
		}
		.footer button {
			float: right;
		}

    .filters a {
      padding: 2px 5px;
      margin-left: 5px;
      text-decoration: none;
      color: red;
      -webkit-appearance: button;
      -moz-appearance: button;
      appearance: button;
    }
    </style>
  </head>
  <body>
   <section id="AppRoot" class="todoapp"></section>
    <script type="text/babel">
    	var todolist = {
    		name: 'todos',
    		todos: [{
    			completed: true,
    			title: 'learn react'
    		},{
    			completed: false,
    			title: 'learn redux'
    		},{
    			completed: false,
    			title: 'learn webpack'
    		},{
    			completed: false,
    			title: 'learn less'
    		}]
    	}

    	var App = React.createClass({
    		getInitialState: function  () {
    			return {
    				addTaskTitle: '',
    				todolist: todolist,
    				type: 'all'
    			}
    		},

    		//表单输入域
    		changeHandel: function  (e) {
    			this.setState({value: e.target.value});
    		},

    		/**
    		 * 添加任务
    		 *
    		 * @param      {<type>}   e       { parameter_description }
    		 * @return     {boolean}  { description_of_the_return_value }
    		 */
   			addTaskHandel: function  (e) {
   				let task = this.refs.addTask;
   				if (task.value === '') {
   					console.error('不能添加空的task');
   					return false;
   				}
   				this.setState(function  () {
   					let todos = this.states.todolist.todos,
   					    todo = {
   					    	completed: false,
   					    	title: task.value
   					    };
   					todos.push(todo);
   					return todos;
   				})
   			},

   			/**
   			 * 删除任务
   			 *
   			 * @param      {<type>}  index   The index
   			 * @return     {<type>}  { description_of_the_return_value }
   			 */
   			deleteTaskHandel: function  (index) {
  				return function  () {
  					let todos = this.state.todolist.todos,
  						todolist = {
  							todolist: {
  								name: 'todos',
  								todos: []
  							}
  						};
  					todos.splice(index, 1);
  					todolist.todolist.todos = todos;

  					this.setState(todolist);

  				}.bind(this)				
   			},

   			/**
   			 * 切换任务状态
   			 */
   			switchTaskCompletedHandel: function  (index) {
  				return function  () {
  					let todolist = this.state.todolist;
  					todolist['todos'][index]['completed'] = !todolist['todos'][index]['completed'];

  					this.setState(todolist);
  				}.bind(this);
   			},

   			/**
   			 * 切换任务类型
   			 */
   			switchListTypeHandel: function  () {
   				return function  (hash, event) {
            let type = '';
            switch (hash) {
              case 'active':
                  type = 'active';
                  break;
              case 'completed':
                  type = 'completed';
                  break;
              default:
                  type = 'all';
                  break;
            }

            this.setState({type: type});
          }.bind(this);
   			},

        /**
         * 删除已经完成的任务
         *
         * @return     {<type>}  { description_of_the_return_value }
         */
        clearCompleted: function  () {
          return function  () {
            let todolist = this.state.todolist,
            todos = todolist.todos.filter(function(todo) {
                return !todo.completed;              
            });

            todolist.todos = todos;

            this.setState(todolist);

          }.bind(this);
        },


        /**
         * 键盘回车事件添加任务
         *
         * @param      {<type>}  e       { parameter_description }
         */
        onEnter: function  (e) {
          var keyCode = e.keyCode ? e.keyCode : e.which;
          var todolist = this.state.todolist;
          if (keyCode === 13) {
            var title = e.target.value;
            if (title.length > 0) {
              todolist.todos.push({completed: false, title: title});
              console.log(todolist)
              this.setState(todolist);
            }   
          }
        },

    		render: function  () {
          
          var todolist = this.state.todolist;

          //计算还有多少个未完成的
          var lefted = todolist.todos.reduce(function  (acc, todo) {
            return todo.completed ? acc : acc + 1;
          }, 0);

          let footer = todolist.todos.length > 0 ? <Footer lefted={lefted} type={this.state.type} switchType={this.switchListTypeHandel()} clearCom={this.clearCompleted()} /> : '';

    			return <div className="box">
    				<Header name={this.state.todolist.name}/>
            <div className="input">
              <input placeholder="what need to be done?" onKeyUp={this.onEnter}/>
            </div>
    				<TodoList todos={this.state.todolist.todos} type={this.state.type} delTask={this.deleteTaskHandel} comTask={this.switchTaskCompletedHandel}/>
    				  {footer}
    			</div>
    		}
    	})

    	var Header = React.createClass({
    		render: function  () {
    			return <header>{this.props.name}</header>
    		}
    	})

    	var TodoList = React.createClass({
    		render: function  () {
          let that = this;  
    			return <ul>
    				{that.props.todos.map(function(todo, i) {
              switch(that.props.type) {
                case 'all':
                  return <TodoItem data={todo} key={i} delTask={that.props.delTask(i)} comTask={that.props.comTask(i)} />
                case 'active':
                    if (!todo.completed) {
                      return <TodoItem data={todo} key={i} delTask={that.props.delTask} comTask={that.props.comTask(i)} />
                    }
                    break;  
                case 'completed':
                    if (todo.completed) {
                      return <TodoItem data={todo} key={i} delTask={that.props.delTask(i)} comTask={that.props.comTask(i)} />
                    }
                    break;
                default:
                    break;

              }
    			  	})
            }
    			</ul>
    		}
    	})

    	var TodoItem = React.createClass({
    		
        render: function  () {
          let todo = this.props.data;
          let className = todo.completed ? 'completed' : '';

    			return <li className={className} >
							<input onClick={this.props.comTask} className="checkbox" type="checkbox" />
							<label className="value">{this.props.data.title}</label>
              <button onClick={this.props.delTask}>X</button>
						</li>
    		}
    	})

    	var Footer = React.createClass({
    		render: function  () {
          let type = ['', '', ''];
          //类型按钮显示
          switch (this.props.type) {
            case 'active':
                type[1] = 'selected';
                break;
            case 'completed':
                type[2] = 'selected';
                break;
            default:
                type[0] = 'selected';
                break;
          }

    			return <div className="footer">
						    <span>{this.props.lefted} items left</span>
						    <div className="filters">
  								<a href="#" className={type[0]} onClick={this.props.switchType.bind(null, 'all')} >All</a>
  								<a href="#" className={type[1]} onClick={this.props.switchType.bind(null, 'active')} >Active</a>
  								<a href="#" className={type[2]} onClick={this.props.switchType.bind(null, 'completed')} >Completed</a>
						    </div>
						    <button onClick={this.props.clearCom}>Clear completed</button>
						</div>
    		}
    	})

    /**
     * render到dom
     */
		ReactDOM.render(<App />, document.getElementById('AppRoot'));



    </script>
  </body>
</html>